{% extends "base.html" %}
{% block content %}
<h1>Resumo (por cClass)</h1>

<div class="card">
  <form action="/resumo/gerar" method="post" enctype="multipart/form-data">
    <p><b>Envie um .zip</b> com XMLs:</p>
    <input type="file" name="zip_xmls" accept=".zip" required><br><br>
    <button class="btn" type="submit">Gerar Resumo</button>
  </form>
</div>

{% if resumo %}
<div class="card">
  <p><b>Total arquivos:</b> {{ resumo.total_arquivos }}</p>
  <p><b>Total geral:</b> {{ resumo.total_geral_br }}</p>
</div>

<div class="card">
  <h3>Gr√°fico (Top 12 cClass)</h3>
  <canvas id="pizza" height="120"></canvas>
</div>

<div class="card">
  <h3>Tabela por cClass</h3>
  <table>
    <thead>
      <tr>
        <th>cClass</th>
        <th>Qtd Itens</th>
        <th>Valor Total</th>
        <th>%</th>
      </tr>
    </thead>
    <tbody>
      {% for r in resumo.linhas %}
      <tr>
        <td>{{ r.cClass }}</td>
        <td>{{ r.qtd_itens }}</td>
        <td>{{ r.v_total_br }}</td>
        <td>{{ r.pct_br }}%</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  const labels = {{ resumo.labels|tojson }};
  const valores = {{ resumo.valores|tojson }};
  const ctx = document.getElementById("pizza");
  new Chart(ctx, {
    type: "pie",
    data: {
      labels: labels,
      datasets: [{ data: valores }]
    }
  });
</script>
{% endif %}

{% endblock %}
